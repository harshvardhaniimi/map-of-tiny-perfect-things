<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Client</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f3f3f3;
        }
        #chat-container {
            overflow-y: scroll;
            height: 80%;
            width: 100%;
            padding: 10px;
            background-color: #fafafa;
        }
        .message {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .text-box {
            display: inline-block;
        }
        .user-message .text-box {
            text-align: right;
        }
        .gpt-message .text-box {
            text-align: left;
        }
        #input-container {
            position: fixed;
            bottom: 0;
            width: 100%;
            padding: 10px;
            background-color: #f3f3f3;
        }
        #messageInput {
            width: 80%;
            font-size: 24px;
            background-color: blanchedalmond;
        }
        #sendButton {
            font-size: 24px;
        }
    </style>
</head>
<body>
    <div id="chat-container"></div>
    <div id="input-container">
        <input type="text" id="messageInput" placeholder="Type your message">
        <button id="sendButton">Send ‚èé</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
    <script>
        const md = window.markdownit();
        const socket = new WebSocket("ws://localhost:8765");

        const userIcon = '<img src="icons/user.png" class="icon" align="right">';
        const gptIcon = '<img src="icons/gpt.png" class="icon" align="left">';

        socket.onopen = (event) => {
            console.log("WebSocket connection opened");
        };

        socket.onmessage = (event) => {
            const chatContainer = document.getElementById("chat-container");
            const messageDiv = document.createElement("div");
            messageDiv.className = "message gpt-message";
            messageDiv.innerHTML = gptIcon + '<div class="text-box">' + md.render(event.data) + '</div>';
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        };
        socket.onclose = (event) => {
            console.log("WebSocket connection closed");
        };

        const sendButton = document.getElementById("sendButton");
        const messageInput = document.getElementById("messageInput");

        sendButton.addEventListener("click", () => {
            const message = messageInput.value;
            socket.send(message);
            messageInput.value = "";

            const chatContainer = document.getElementById("chat-container");
            const messageDiv = document.createElement("div");
            messageDiv.className = "message user-message";
            messageDiv.innerHTML = userIcon + '<div class="text-box">' + message + '</div>';
            // if needed to have "You say", put it as '<div class="text-box"> You say:'
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        });

        // Create a function for sending messages so it can be reused
        function sendMessage() {
            const message = messageInput.value;
            socket.send(message);
            messageInput.value = "";

            const chatContainer = document.getElementById("chat-container");
            const messageDiv = document.createElement("div");
            messageDiv.className = "message user-message";
            messageDiv.innerHTML = userIcon + '<div class="text-box">' + message + '</div>';
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Existing sendButton event listener...
        sendButton.addEventListener("click", sendMessage);

        // New event listener for the Enter key
        messageInput.addEventListener("keyup", (event) => {
            if (event.key === "Enter") {
                sendMessage();
            }
        });
    </script>
</body>
</html>
